/**
********************************************************************************
\file   trace-sim.c

\brief  Trace function using simulation interface

*******************************************************************************/

/*------------------------------------------------------------------------------
Copyright (c) 2016, Franz Profelt (franz.profelt@gmail.com)
------------------------------------------------------------------------------*/

//------------------------------------------------------------------------------
// includes
//------------------------------------------------------------------------------

#include <common/oplkinc.h>
#include <stdarg.h>
#include "../../sim/simoutput.h"

//============================================================================//
//            G L O B A L   D E F I N I T I O N S                             //
//============================================================================//

//------------------------------------------------------------------------------
// const defines
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
// module global vars
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
// global function prototypes
//------------------------------------------------------------------------------

//============================================================================//
//            P R I V A T E   D E F I N I T I O N S                           //
//============================================================================//

//------------------------------------------------------------------------------
// const defines
//------------------------------------------------------------------------------

//------------------------------------------------------------------------------
// local types
//------------------------------------------------------------------------------

/**
\brief Trace instance

 Instance structure containing the static char buffer
 */
typedef struct
{
    char buffer[TRACE_SIM_BUFFER_SIZE]; ///< Buffer for trace messages
} tTraceInstance;

//------------------------------------------------------------------------------
// local vars
//------------------------------------------------------------------------------

static tTraceInstance traceInstance_l;

//------------------------------------------------------------------------------
// local function prototypes
//------------------------------------------------------------------------------

//============================================================================//
//            P U B L I C   F U N C T I O N S                                 //
//============================================================================//

//------------------------------------------------------------------------------
/**
\brief  Print debug trace message

The function prints a debug trace message using the simulation inteface

\param  fmt         Format string
\param  ...         Arguments to print
*/
//------------------------------------------------------------------------------
void trace(const char* fmt, ...)
{
    // clear buffer
    OPLK_MEMSET(traceInstance_l.buffer, 0, TRACE_SIM_BUFFER_SIZE);

    va_list argptr;

    va_start(argptr, fmt);
    sprintf(traceInstance_l.buffer, fmt, argptr);
    va_end(argptr);

    sim_trace(traceInstance_l.buffer);
}
